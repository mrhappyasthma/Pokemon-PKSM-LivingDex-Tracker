from enum import Enum, auto
from types import SimpleNamespace

# Based on PKSM bank.cpp and bank.hpp
BANK_MAGIC = 'PKSMBANK'
BANK_VERSION = 3
SIZE_OF_UINT32_IN_BYTES = 4
SIZE_OF_UINT16_IN_BYTES = 2
ENTRIES_PER_BOX = 30
ENTRY_DATA_SIZE = 0x148
ENTRY_PADDING_SIZE = 4

# Based on PKSM-Core enums/Generation.hpp
class Generation(Enum):
  ONE = 7
  TWO = 8
  THREE = 6
  FOUR = 0
  FIVE = 1
  SIX = 2
  SEVEN = 3
  LGPE = 4
  EIGHT = 5
  UNUSED = 0xFFFFFFFF

# Based on PKSM-Core enums/Species.hpp
class Species(Enum):
  UNSPECIFIED = 0
  Bulbasaur = auto()
  Ivysaur = auto()
  Venusaur = auto()
  Charmander = auto()
  Charmeleon = auto()
  Charizard = auto()
  Squirtle = auto()
  Wartortle = auto()
  Blastoise = auto()
  Caterpie = auto()
  Metapod = auto()
  Butterfree = auto()
  Weedle = auto()
  Kakuna = auto()
  Beedrill = auto()
  Pidgey = auto()
  Pidgeotto = auto()
  Pidgeot = auto()
  Rattata = auto()
  Raticate = auto()
  Spearow = auto()
  Fearow = auto()
  Ekans = auto()
  Arbok = auto()
  Pikachu = auto()
  Raichu = auto()
  Sandshrew = auto()
  Sandslash = auto()
  NidoranF = auto()
  Nidorina = auto()
  Nidoqueen = auto()
  NidoranM = auto()
  Nidorino = auto()
  Nidoking = auto()
  Clefairy = auto()
  Clefable = auto()
  Vulpix = auto()
  Ninetales = auto()
  Jigglypuff = auto()
  Wigglytuff = auto()
  Zubat = auto()
  Golbat = auto()
  Oddish = auto()
  Gloom = auto()
  Vileplume = auto()
  Paras = auto()
  Parasect = auto()
  Venonat = auto()
  Venomoth = auto()
  Diglett = auto()
  Dugtrio = auto()
  Meowth = auto()
  Persian = auto()
  Psyduck = auto()
  Golduck = auto()
  Mankey = auto()
  Primeape = auto()
  Growlithe = auto()
  Arcanine = auto()
  Poliwag = auto()
  Poliwhirl = auto()
  Poliwrath = auto()
  Abra = auto()
  Kadabra = auto()
  Alakazam = auto()
  Machop = auto()
  Machoke = auto()
  Machamp = auto()
  Bellsprout = auto()
  Weepinbell = auto()
  Victreebel = auto()
  Tentacool = auto()
  Tentacruel = auto()
  Geodude = auto()
  Graveler = auto()
  Golem = auto()
  Ponyta = auto()
  Rapidash = auto()
  Slowpoke = auto()
  Slowbro = auto()
  Magnemite = auto()
  Magneton = auto()
  Farfetchd = auto()
  Doduo = auto()
  Dodrio = auto()
  Seel = auto()
  Dewgong = auto()
  Grimer = auto()
  Muk = auto()
  Shellder = auto()
  Cloyster = auto()
  Gastly = auto()
  Haunter = auto()
  Gengar = auto()
  Onix = auto()
  Drowzee = auto()
  Hypno = auto()
  Krabby = auto()
  Kingler = auto()
  Voltorb = auto()
  Electrode = auto()
  Exeggcute = auto()
  Exeggutor = auto()
  Cubone = auto()
  Marowak = auto()
  Hitmonlee = auto()
  Hitmonchan = auto()
  Lickitung = auto()
  Koffing = auto()
  Weezing = auto()
  Rhyhorn = auto()
  Rhydon = auto()
  Chansey = auto()
  Tangela = auto()
  Kangaskhan = auto()
  Horsea = auto()
  Seadra = auto()
  Goldeen = auto()
  Seaking = auto()
  Staryu = auto()
  Starmie = auto()
  MrMime = auto()
  Scyther = auto()
  Jynx = auto()
  Electabuzz = auto()
  Magmar = auto()
  Pinsir = auto()
  Tauros = auto()
  Magikarp = auto()
  Gyarados = auto()
  Lapras = auto()
  Ditto = auto()
  Eevee = auto()
  Vaporeon = auto()
  Jolteon = auto()
  Flareon = auto()
  Porygon = auto()
  Omanyte = auto()
  Omastar = auto()
  Kabuto = auto()
  Kabutops = auto()
  Aerodactyl = auto()
  Snorlax = auto()
  Articuno = auto()
  Zapdos = auto()
  Moltres = auto()
  Dratini = auto()
  Dragonair = auto()
  Dragonite = auto()
  Mewtwo = auto()
  Mew = auto()
  Chikorita = auto()
  Bayleef = auto()
  Meganium = auto()
  Cyndaquil = auto()
  Quilava = auto()
  Typhlosion = auto()
  Totodile = auto()
  Croconaw = auto()
  Feraligatr = auto()
  Sentret = auto()
  Furret = auto()
  Hoothoot = auto()
  Noctowl = auto()
  Ledyba = auto()
  Ledian = auto()
  Spinarak = auto()
  Ariados = auto()
  Crobat = auto()
  Chinchou = auto()
  Lanturn = auto()
  Pichu = auto()
  Cleffa = auto()
  Igglybuff = auto()
  Togepi = auto()
  Togetic = auto()
  Natu = auto()
  Xatu = auto()
  Mareep = auto()
  Flaaffy = auto()
  Ampharos = auto()
  Bellossom = auto()
  Marill = auto()
  Azumarill = auto()
  Sudowoodo = auto()
  Politoed = auto()
  Hoppip = auto()
  Skiploom = auto()
  Jumpluff = auto()
  Aipom = auto()
  Sunkern = auto()
  Sunflora = auto()
  Yanma = auto()
  Wooper = auto()
  Quagsire = auto()
  Espeon = auto()
  Umbreon = auto()
  Murkrow = auto()
  Slowking = auto()
  Misdreavus = auto()
  Unown = auto()
  Wobbuffet = auto()
  Girafarig = auto()
  Pineco = auto()
  Forretress = auto()
  Dunsparce = auto()
  Gligar = auto()
  Steelix = auto()
  Snubbull = auto()
  Granbull = auto()
  Qwilfish = auto()
  Scizor = auto()
  Shuckle = auto()
  Heracross = auto()
  Sneasel = auto()
  Teddiursa = auto()
  Ursaring = auto()
  Slugma = auto()
  Magcargo = auto()
  Swinub = auto()
  Piloswine = auto()
  Corsola = auto()
  Remoraid = auto()
  Octillery = auto()
  Delibird = auto()
  Mantine = auto()
  Skarmory = auto()
  Houndour = auto()
  Houndoom = auto()
  Kingdra = auto()
  Phanpy = auto()
  Donphan = auto()
  Porygon2 = auto()
  Stantler = auto()
  Smeargle = auto()
  Tyrogue = auto()
  Hitmontop = auto()
  Smoochum = auto()
  Elekid = auto()
  Magby = auto()
  Miltank = auto()
  Blissey = auto()
  Raikou = auto()
  Entei = auto()
  Suicune = auto()
  Larvitar = auto()
  Pupitar = auto()
  Tyranitar = auto()
  Lugia = auto()
  HoOh = auto()
  Celebi = auto()
  Treecko = auto()
  Grovyle = auto()
  Sceptile = auto()
  Torchic = auto()
  Combusken = auto()
  Blaziken = auto()
  Mudkip = auto()
  Marshtomp = auto()
  Swampert = auto()
  Poochyena = auto()
  Mightyena = auto()
  Zigzagoon = auto()
  Linoone = auto()
  Wurmple = auto()
  Silcoon = auto()
  Beautifly = auto()
  Cascoon = auto()
  Dustox = auto()
  Lotad = auto()
  Lombre = auto()
  Ludicolo = auto()
  Seedot = auto()
  Nuzleaf = auto()
  Shiftry = auto()
  Taillow = auto()
  Swellow = auto()
  Wingull = auto()
  Pelipper = auto()
  Ralts = auto()
  Kirlia = auto()
  Gardevoir = auto()
  Surskit = auto()
  Masquerain = auto()
  Shroomish = auto()
  Breloom = auto()
  Slakoth = auto()
  Vigoroth = auto()
  Slaking = auto()
  Nincada = auto()
  Ninjask = auto()
  Shedinja = auto()
  Whismur = auto()
  Loudred = auto()
  Exploud = auto()
  Makuhita = auto()
  Hariyama = auto()
  Azurill = auto()
  Nosepass = auto()
  Skitty = auto()
  Delcatty = auto()
  Sableye = auto()
  Mawile = auto()
  Aron = auto()
  Lairon = auto()
  Aggron = auto()
  Meditite = auto()
  Medicham = auto()
  Electrike = auto()
  Manectric = auto()
  Plusle = auto()
  Minun = auto()
  Volbeat = auto()
  Illumise = auto()
  Roselia = auto()
  Gulpin = auto()
  Swalot = auto()
  Carvanha = auto()
  Sharpedo = auto()
  Wailmer = auto()
  Wailord = auto()
  Numel = auto()
  Camerupt = auto()
  Torkoal = auto()
  Spoink = auto()
  Grumpig = auto()
  Spinda = auto()
  Trapinch = auto()
  Vibrava = auto()
  Flygon = auto()
  Cacnea = auto()
  Cacturne = auto()
  Swablu = auto()
  Altaria = auto()
  Zangoose = auto()
  Seviper = auto()
  Lunatone = auto()
  Solrock = auto()
  Barboach = auto()
  Whiscash = auto()
  Corphish = auto()
  Crawdaunt = auto()
  Baltoy = auto()
  Claydol = auto()
  Lileep = auto()
  Cradily = auto()
  Anorith = auto()
  Armaldo = auto()
  Feebas = auto()
  Milotic = auto()
  Castform = auto()
  Kecleon = auto()
  Shuppet = auto()
  Banette = auto()
  Duskull = auto()
  Dusclops = auto()
  Tropius = auto()
  Chimecho = auto()
  Absol = auto()
  Wynaut = auto()
  Snorunt = auto()
  Glalie = auto()
  Spheal = auto()
  Sealeo = auto()
  Walrein = auto()
  Clamperl = auto()
  Huntail = auto()
  Gorebyss = auto()
  Relicanth = auto()
  Luvdisc = auto()
  Bagon = auto()
  Shelgon = auto()
  Salamence = auto()
  Beldum = auto()
  Metang = auto()
  Metagross = auto()
  Regirock = auto()
  Regice = auto()
  Registeel = auto()
  Latias = auto()
  Latios = auto()
  Kyogre = auto()
  Groudon = auto()
  Rayquaza = auto()
  Jirachi = auto()
  Deoxys = auto()
  Turtwig = auto()
  Grotle = auto()
  Torterra = auto()
  Chimchar = auto()
  Monferno = auto()
  Infernape = auto()
  Piplup = auto()
  Prinplup = auto()
  Empoleon = auto()
  Starly = auto()
  Staravia = auto()
  Staraptor = auto()
  Bidoof = auto()
  Bibarel = auto()
  Kricketot = auto()
  Kricketune = auto()
  Shinx = auto()
  Luxio = auto()
  Luxray = auto()
  Budew = auto()
  Roserade = auto()
  Cranidos = auto()
  Rampardos = auto()
  Shieldon = auto()
  Bastiodon = auto()
  Burmy = auto()
  Wormadam = auto()
  Mothim = auto()
  Combee = auto()
  Vespiquen = auto()
  Pachirisu = auto()
  Buizel = auto()
  Floatzel = auto()
  Cherubi = auto()
  Cherrim = auto()
  Shellos = auto()
  Gastrodon = auto()
  Ambipom = auto()
  Drifloon = auto()
  Drifblim = auto()
  Buneary = auto()
  Lopunny = auto()
  Mismagius = auto()
  Honchkrow = auto()
  Glameow = auto()
  Purugly = auto()
  Chingling = auto()
  Stunky = auto()
  Skuntank = auto()
  Bronzor = auto()
  Bronzong = auto()
  Bonsly = auto()
  MimeJr = auto()
  Happiny = auto()
  Chatot = auto()
  Spiritomb = auto()
  Gible = auto()
  Gabite = auto()
  Garchomp = auto()
  Munchlax = auto()
  Riolu = auto()
  Lucario = auto()
  Hippopotas = auto()
  Hippowdon = auto()
  Skorupi = auto()
  Drapion = auto()
  Croagunk = auto()
  Toxicroak = auto()
  Carnivine = auto()
  Finneon = auto()
  Lumineon = auto()
  Mantyke = auto()
  Snover = auto()
  Abomasnow = auto()
  Weavile = auto()
  Magnezone = auto()
  Lickilicky = auto()
  Rhyperior = auto()
  Tangrowth = auto()
  Electivire = auto()
  Magmortar = auto()
  Togekiss = auto()
  Yanmega = auto()
  Leafeon = auto()
  Glaceon = auto()
  Gliscor = auto()
  Mamoswine = auto()
  PorygonZ = auto()
  Gallade = auto()
  Probopass = auto()
  Dusknoir = auto()
  Froslass = auto()
  Rotom = auto()
  Uxie = auto()
  Mesprit = auto()
  Azelf = auto()
  Dialga = auto()
  Palkia = auto()
  Heatran = auto()
  Regigigas = auto()
  Giratina = auto()
  Cresselia = auto()
  Phione = auto()
  Manaphy = auto()
  Darkrai = auto()
  Shaymin = auto()
  Arceus = auto()
  Victini = auto()
  Snivy = auto()
  Servine = auto()
  Serperior = auto()
  Tepig = auto()
  Pignite = auto()
  Emboar = auto()
  Oshawott = auto()
  Dewott = auto()
  Samurott = auto()
  Patrat = auto()
  Watchog = auto()
  Lillipup = auto()
  Herdier = auto()
  Stoutland = auto()
  Purrloin = auto()
  Liepard = auto()
  Pansage = auto()
  Simisage = auto()
  Pansear = auto()
  Simisear = auto()
  Panpour = auto()
  Simipour = auto()
  Munna = auto()
  Musharna = auto()
  Pidove = auto()
  Tranquill = auto()
  Unfezant = auto()
  Blitzle = auto()
  Zebstrika = auto()
  Roggenrola = auto()
  Boldore = auto()
  Gigalith = auto()
  Woobat = auto()
  Swoobat = auto()
  Drilbur = auto()
  Excadrill = auto()
  Audino = auto()
  Timburr = auto()
  Gurdurr = auto()
  Conkeldurr = auto()
  Tympole = auto()
  Palpitoad = auto()
  Seismitoad = auto()
  Throh = auto()
  Sawk = auto()
  Sewaddle = auto()
  Swadloon = auto()
  Leavanny = auto()
  Venipede = auto()
  Whirlipede = auto()
  Scolipede = auto()
  Cottonee = auto()
  Whimsicott = auto()
  Petilil = auto()
  Lilligant = auto()
  Basculin = auto()
  Sandile = auto()
  Krokorok = auto()
  Krookodile = auto()
  Darumaka = auto()
  Darmanitan = auto()
  Maractus = auto()
  Dwebble = auto()
  Crustle = auto()
  Scraggy = auto()
  Scrafty = auto()
  Sigilyph = auto()
  Yamask = auto()
  Cofagrigus = auto()
  Tirtouga = auto()
  Carracosta = auto()
  Archen = auto()
  Archeops = auto()
  Trubbish = auto()
  Garbodor = auto()
  Zorua = auto()
  Zoroark = auto()
  Minccino = auto()
  Cinccino = auto()
  Gothita = auto()
  Gothorita = auto()
  Gothitelle = auto()
  Solosis = auto()
  Duosion = auto()
  Reuniclus = auto()
  Ducklett = auto()
  Swanna = auto()
  Vanillite = auto()
  Vanillish = auto()
  Vanilluxe = auto()
  Deerling = auto()
  Sawsbuck = auto()
  Emolga = auto()
  Karrablast = auto()
  Escavalier = auto()
  Foongus = auto()
  Amoonguss = auto()
  Frillish = auto()
  Jellicent = auto()
  Alomomola = auto()
  Joltik = auto()
  Galvantula = auto()
  Ferroseed = auto()
  Ferrothorn = auto()
  Klink = auto()
  Klang = auto()
  Klinklang = auto()
  Tynamo = auto()
  Eelektrik = auto()
  Eelektross = auto()
  Elgyem = auto()
  Beheeyem = auto()
  Litwick = auto()
  Lampent = auto()
  Chandelure = auto()
  Axew = auto()
  Fraxure = auto()
  Haxorus = auto()
  Cubchoo = auto()
  Beartic = auto()
  Cryogonal = auto()
  Shelmet = auto()
  Accelgor = auto()
  Stunfisk = auto()
  Mienfoo = auto()
  Mienshao = auto()
  Druddigon = auto()
  Golett = auto()
  Golurk = auto()
  Pawniard = auto()
  Bisharp = auto()
  Bouffalant = auto()
  Rufflet = auto()
  Braviary = auto()
  Vullaby = auto()
  Mandibuzz = auto()
  Heatmor = auto()
  Durant = auto()
  Deino = auto()
  Zweilous = auto()
  Hydreigon = auto()
  Larvesta = auto()
  Volcarona = auto()
  Cobalion = auto()
  Terrakion = auto()
  Virizion = auto()
  Tornadus = auto()
  Thundurus = auto()
  Reshiram = auto()
  Zekrom = auto()
  Landorus = auto()
  Kyurem = auto()
  Keldeo = auto()
  Meloetta = auto()
  Genesect = auto()
  Chespin = auto()
  Quilladin = auto()
  Chesnaught = auto()
  Fennekin = auto()
  Braixen = auto()
  Delphox = auto()
  Froakie = auto()
  Frogadier = auto()
  Greninja = auto()
  Bunnelby = auto()
  Diggersby = auto()
  Fletchling = auto()
  Fletchinder = auto()
  Talonflame = auto()
  Scatterbug = auto()
  Spewpa = auto()
  Vivillon = auto()
  Litleo = auto()
  Pyroar = auto()
  Flabebe = auto()
  Floette = auto()
  Florges = auto()
  Skiddo = auto()
  Gogoat = auto()
  Pancham = auto()
  Pangoro = auto()
  Furfrou = auto()
  Espurr = auto()
  Meowstic = auto()
  Honedge = auto()
  Doublade = auto()
  Aegislash = auto()
  Spritzee = auto()
  Aromatisse = auto()
  Swirlix = auto()
  Slurpuff = auto()
  Inkay = auto()
  Malamar = auto()
  Binacle = auto()
  Barbaracle = auto()
  Skrelp = auto()
  Dragalge = auto()
  Clauncher = auto()
  Clawitzer = auto()
  Helioptile = auto()
  Heliolisk = auto()
  Tyrunt = auto()
  Tyrantrum = auto()
  Amaura = auto()
  Aurorus = auto()
  Sylveon = auto()
  Hawlucha = auto()
  Dedenne = auto()
  Carbink = auto()
  Goomy = auto()
  Sliggoo = auto()
  Goodra = auto()
  Klefki = auto()
  Phantump = auto()
  Trevenant = auto()
  Pumpkaboo = auto()
  Gourgeist = auto()
  Bergmite = auto()
  Avalugg = auto()
  Noibat = auto()
  Noivern = auto()
  Xerneas = auto()
  Yveltal = auto()
  Zygarde = auto()
  Diancie = auto()
  Hoopa = auto()
  Volcanion = auto()
  Rowlet = auto()
  Dartrix = auto()
  Decidueye = auto()
  Litten = auto()
  Torracat = auto()
  Incineroar = auto()
  Popplio = auto()
  Brionne = auto()
  Primarina = auto()
  Pikipek = auto()
  Trumbeak = auto()
  Toucannon = auto()
  Yungoos = auto()
  Gumshoos = auto()
  Grubbin = auto()
  Charjabug = auto()
  Vikavolt = auto()
  Crabrawler = auto()
  Crabominable = auto()
  Oricorio = auto()
  Cutiefly = auto()
  Ribombee = auto()
  Rockruff = auto()
  Lycanroc = auto()
  Wishiwashi = auto()
  Mareanie = auto()
  Toxapex = auto()
  Mudbray = auto()
  Mudsdale = auto()
  Dewpider = auto()
  Araquanid = auto()
  Fomantis = auto()
  Lurantis = auto()
  Morelull = auto()
  Shiinotic = auto()
  Salandit = auto()
  Salazzle = auto()
  Stufful = auto()
  Bewear = auto()
  Bounsweet = auto()
  Steenee = auto()
  Tsareena = auto()
  Comfey = auto()
  Oranguru = auto()
  Passimian = auto()
  Wimpod = auto()
  Golisopod = auto()
  Sandygast = auto()
  Palossand = auto()
  Pyukumuku = auto()
  TypeNull = auto()
  Silvally = auto()
  Minior = auto()
  Komala = auto()
  Turtonator = auto()
  Togedemaru = auto()
  Mimikyu = auto()
  Bruxish = auto()
  Drampa = auto()
  Dhelmise = auto()
  Jangmoo = auto()
  Hakamoo = auto()
  Kommoo = auto()
  TapuKoko = auto()
  TapuLele = auto()
  TapuBulu = auto()
  TapuFini = auto()
  Cosmog = auto()
  Cosmoem = auto()
  Solgaleo = auto()
  Lunala = auto()
  Nihilego = auto()
  Buzzwole = auto()
  Pheromosa = auto()
  Xurkitree = auto()
  Celesteela = auto()
  Kartana = auto()
  Guzzlord = auto()
  Necrozma = auto()
  Magearna = auto()
  Marshadow = auto()
  Poipole = auto()
  Naganadel = auto()
  Stakataka = auto()
  Blacephalon = auto()
  Zeraora = auto()
  Meltan = auto()
  Melmetal = auto()
  Grookey = auto()
  Thwackey = auto()
  Rillaboom = auto()
  Scorbunny = auto()
  Raboot = auto()
  Cinderace = auto()
  Sobble = auto()
  Drizzile = auto()
  Inteleon = auto()
  Skwovet = auto()
  Greedent = auto()
  Rookidee = auto()
  Corvisquire = auto()
  Corviknight = auto()
  Blipbug = auto()
  Dottler = auto()
  Orbeetle = auto()
  Nickit = auto()
  Thievul = auto()
  Gossifleur = auto()
  Eldegoss = auto()
  Wooloo = auto()
  Dubwool = auto()
  Chewtle = auto()
  Drednaw = auto()
  Yamper = auto()
  Boltund = auto()
  Rolycoly = auto()
  Carkol = auto()
  Coalossal = auto()
  Applin = auto()
  Flapple = auto()
  Appletun = auto()
  Silicobra = auto()
  Sandaconda = auto()
  Cramorant = auto()
  Arrokuda = auto()
  Barraskewda = auto()
  Toxel = auto()
  Toxtricity = auto()
  Sizzlipede = auto()
  Centiskorch = auto()
  Clobbopus = auto()
  Grapploct = auto()
  Sinistea = auto()
  Polteageist = auto()
  Hatenna = auto()
  Hattrem = auto()
  Hatterene = auto()
  Impidimp = auto()
  Morgrem = auto()
  Grimmsnarl = auto()
  Obstagoon = auto()
  Perrserker = auto()
  Cursola = auto()
  Sirfetchd = auto()
  MrRime = auto()
  Runerigus = auto()
  Milcery = auto()
  Alcremie = auto()
  Falinks = auto()
  Pincurchin = auto()
  Snom = auto()
  Frosmoth = auto()
  Stonjourner = auto()
  Eiscue = auto()
  Indeedee = auto()
  Morpeko = auto()
  Cufant = auto()
  Copperajah = auto()
  Dracozolt = auto()
  Arctozolt = auto()
  Dracovish = auto()
  Arctovish = auto()
  Duraludon = auto()
  Dreepy = auto()
  Drakloak = auto()
  Dragapult = auto()
  Zacian = auto()
  Zamazenta = auto()
  Eternatus = auto()
  Kubfu = auto()
  Urshifu = auto()
  Zarude = auto()
  Regieleki = auto()
  Regidrago = auto()
  Glastrier = auto()
  Spectrier = auto()
  Calyrex = auto()
  UNUSED = 0xFFFF

GEN_1 = 151  # Red, blue, yellow
GEN_2 = 251  # Gold, silver, crystal
GEN_3 = 386  # Sapphire, ruby, emerald
GEN_4 = 493  # Diamond, pearl, platinum
GEN_5 = 649  # Black, white (black 2, white 2)
GEN_6 = 721  # X, Y (Omega ruby, alpha sapphire)
GEN_7_A = 802  # Sun, moon (ultra sun, ultra moon)
GEN_7_B = 807  # Ultra sun, ultra moon
GEN_7_C = 809  # Pokemon Let's Go / Pokemon Go
GEN_8 = 898 # Sword, Shield TODO: Update when finalized.

def GameContainingSpecies(species):
  number = species.value
  if number <= GEN_1:
    return 'Red, blue, yellow'
  elif number <= GEN_2:
    return 'Gold, silver, crystal'
  elif number <= GEN_3:
    return 'Sapphire, ruby, emerald'
  elif number <= GEN_4:
    return 'Diamond, pearl, platinum'
  elif number <= GEN_5:
    return 'Black (2), White (2)'
  elif number <= GEN_6:
    return 'X, Y, (Omega Ruby, Alpha Sapphire)'
  elif number <= GEN_7_A:
    return 'Sun, Moon, (Ultra Sun, Ultra Moon)'
  elif number <= GEN_7_B:
    return 'Ultra Sun, Ultra Moon'
  elif number <= GEN_7_C:
    return "Pokemon Let's Go / Pokemon Go"
  elif number <= GEN_8:
    return 'Sword, Shield'
  else:
    return 'Unknown'


with open ('banks/livingdex.bnk', 'rb') as bank_file:
  magic = bank_file.read(8).decode("utf-8")
  if magic != BANK_MAGIC:
    print('Invalid file! This file is not a supported PKSM bank file.')
    exit(1)
  version = int.from_bytes(bank_file.read(SIZE_OF_UINT32_IN_BYTES), byteorder='little')
  if version < BANK_VERSION:
    print('Script does not currently support legacy versions!')
  elif version > BANK_VERSION:
    print('This version is from the future! This script is still on version ' + str(version))
  boxes = int.from_bytes(bank_file.read(SIZE_OF_UINT32_IN_BYTES), byteorder='little')
  entries_count = boxes * ENTRIES_PER_BOX
  entries = []
  for i in range(0, entries_count):
    entry = SimpleNamespace()
    generation = int.from_bytes(bank_file.read(SIZE_OF_UINT32_IN_BYTES), byteorder='little')
    entry.generation = Generation(generation)
    entry.data = bank_file.read(ENTRY_DATA_SIZE)
    entry.padding = bank_file.read(ENTRY_PADDING_SIZE)
    entries.append(entry)

  captured_pokemon = []
  for entry in entries:
    pokemon = SimpleNamespace()
    end_index = 0x08 + SIZE_OF_UINT16_IN_BYTES
    species = Species(int.from_bytes(entry.data[0x08:end_index], byteorder='little'))
    if species == Species.UNUSED or species == Species.UNSPECIFIED:
      continue
    pokemon.species = species
    pokemon.generation = entry.generation
    pokemon.game = GameContainingSpecies(species)
    captured_pokemon.append(pokemon)
  
  total_pokemon_count = len(Species)-2
  captured_count = len(captured_pokemon)
  completion_percentage = captured_count / total_pokemon_count
  print(f"Overall Completion percentage: {completion_percentage:.2%}\n")
  
  # Track the list of missing pokemon from each living dex.
  living_dex_gen1 = list(range(1, GEN_1+1))
  living_dex_gen2 = list(range(living_dex_gen1[-1]+1, GEN_2+1))
  living_dex_gen3 = list(range(living_dex_gen2[-1]+1, GEN_3+1))
  living_dex_gen4 = list(range(living_dex_gen3[-1]+1, GEN_4+1))
  living_dex_gen5 = list(range(living_dex_gen4[-1]+1, GEN_5+1))
  living_dex_gen6 = list(range(living_dex_gen5[-1]+1, GEN_6+1))
  living_dex_gen7 = list(range(living_dex_gen6[-1]+1, GEN_7_C+1))
  living_dex_gen8 = list(range(living_dex_gen7[-1]+1, GEN_8+1))
  
  # Cross off any pokemon that we already have
  for pokemon in captured_pokemon:
    number = pokemon.species.value
    if number in living_dex_gen1: living_dex_gen1.remove(number)
    if number in living_dex_gen2: living_dex_gen2.remove(number)
    if number in living_dex_gen3: living_dex_gen3.remove(number)
    if number in living_dex_gen4: living_dex_gen4.remove(number)
    if number in living_dex_gen5: living_dex_gen5.remove(number)
    if number in living_dex_gen6: living_dex_gen6.remove(number)
    if number in living_dex_gen7: living_dex_gen7.remove(number)
    if number in living_dex_gen8: living_dex_gen8.remove(number)
    
  gen1_completion_percentage = 1 - (len(living_dex_gen1) / GEN_1)
  print(f"Gen1 Completion percentage: {gen1_completion_percentage:.2%} - missing {len(living_dex_gen1)}")
  if len(living_dex_gen1):
    print([Species(pokemon).name for pokemon in living_dex_gen1])
  print('')

  gen2_completion_percentage = 1 - (len(living_dex_gen2) / (GEN_2 - GEN_1))
  print(f"Gen2 Completion percentage: {gen2_completion_percentage:.2%} - missing {len(living_dex_gen2)}")
  if len(living_dex_gen2):
    print([Species(pokemon).name for pokemon in living_dex_gen2])
  print('')
  
  gen3_completion_percentage = 1 - (len(living_dex_gen3) / (GEN_3 - GEN_2))
  print(f"Gen3 Completion percentage: {gen3_completion_percentage:.2%} - missing {len(living_dex_gen3)}")
  if len(living_dex_gen3):
    print([Species(pokemon).name for pokemon in living_dex_gen3])
  print('')
  
  gen4_completion_percentage = 1 - (len(living_dex_gen4) / (GEN_4 - GEN_3))
  print(f"Gen4 Completion percentage: {gen4_completion_percentage:.2%} - missing {len(living_dex_gen4)}")
  if len(living_dex_gen4):
    print([Species(pokemon).name for pokemon in living_dex_gen4])
  print('')
  
  gen5_completion_percentage = 1 - (len(living_dex_gen5) / (GEN_5 - GEN_4))
  print(f"Gen5 Completion percentage: {gen5_completion_percentage:.2%} - missing {len(living_dex_gen5)}")
  if len(living_dex_gen5):
    print([Species(pokemon).name for pokemon in living_dex_gen5])
  print('')
  
  gen6_completion_percentage = 1 - (len(living_dex_gen6) / (GEN_6 - GEN_5))
  print(f"Gen6 Completion percentage: {gen6_completion_percentage:.2%} - missing {len(living_dex_gen6)}")
  if len(living_dex_gen6):
    print([Species(pokemon).name for pokemon in living_dex_gen6])
  print('')

  gen7_completion_percentage = 1 - (len(living_dex_gen7) / (GEN_7_C - GEN_6))
  print(f"Gen7 Completion percentage: {gen7_completion_percentage:.2%} - missing {len(living_dex_gen7)}")
  if len(living_dex_gen7):
    print([Species(pokemon).name for pokemon in living_dex_gen7])
  print('')

  gen8_completion_percentage = 1 - (len(living_dex_gen8) / (GEN_8 - GEN_7_C))
  print(f"Gen8 Completion percentage: {gen8_completion_percentage:.2%} - missing {len(living_dex_gen8)}")
  if len(living_dex_gen8):
    print([Species(pokemon).name for pokemon in living_dex_gen8])